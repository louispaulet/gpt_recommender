import{r as V,j as p,S as Hn,R as Is}from"./index-DIL82MVa.js";const Pn="RFC3986",Rn={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},Qa="RFC1738",ei=Array.isArray,pe=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),mn=1024,ti=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=mn){const c=a.length>=mn?a.slice(o,o+mn):a,l=[];for(let u=0;u<c.length;++u){let h=c.charCodeAt(u);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||r===Qa&&(h===40||h===41)){l[l.length]=c.charAt(u);continue}if(h<128){l[l.length]=pe[h];continue}if(h<2048){l[l.length]=pe[192|h>>6]+pe[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=pe[224|h>>12]+pe[128|h>>6&63]+pe[128|h&63];continue}u+=1,h=65536+((h&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=pe[240|h>>18]+pe[128|h>>12&63]+pe[128|h>>6&63]+pe[128|h&63]}i+=l.join("")}return i};function ni(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Ns(s,e){if(ei(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const si=Object.prototype.hasOwnProperty,xr={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},ge=Array.isArray,ri=Array.prototype.push,kr=function(s,e){ri.apply(s,ge(e)?e:[e])},ai=Date.prototype.toISOString,K={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ti,encodeValuesOnly:!1,format:Pn,formatter:Rn[Pn],indices:!1,serializeDate(s){return ai.call(s)},skipNulls:!1,strictNullHandling:!1};function ii(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const pn={};function Sr(s,e,t,n,r,a,i,o,c,l,u,h,d,g,v,w,y,M){let _=s,R=M,C=0,z=!1;for(;(R=R.get(pn))!==void 0&&!z;){const W=R.get(s);if(C+=1,typeof W<"u"){if(W===C)throw new RangeError("Cyclic object value");z=!0}typeof R.get(pn)>"u"&&(C=0)}if(typeof l=="function"?_=l(e,_):_ instanceof Date?_=d==null?void 0:d(_):t==="comma"&&ge(_)&&(_=Ns(_,function(W){return W instanceof Date?d==null?void 0:d(W):W})),_===null){if(a)return c&&!w?c(e,K.encoder,y,"key",g):e;_=""}if(ii(_)||ni(_)){if(c){const W=w?e:c(e,K.encoder,y,"key",g);return[(v==null?void 0:v(W))+"="+(v==null?void 0:v(c(_,K.encoder,y,"value",g)))]}return[(v==null?void 0:v(e))+"="+(v==null?void 0:v(String(_)))]}const N=[];if(typeof _>"u")return N;let I;if(t==="comma"&&ge(_))w&&c&&(_=Ns(_,c)),I=[{value:_.length>0?_.join(",")||null:void 0}];else if(ge(l))I=l;else{const W=Object.keys(_);I=u?W.sort(u):W}const $=o?String(e).replace(/\./g,"%2E"):String(e),j=n&&ge(_)&&_.length===1?$+"[]":$;if(r&&ge(_)&&_.length===0)return j+"[]";for(let W=0;W<I.length;++W){const Z=I[W],me=typeof Z=="object"&&typeof Z.value<"u"?Z.value:_[Z];if(i&&me===null)continue;const Ze=h&&o?Z.replace(/\./g,"%2E"):Z,Ts=ge(_)?typeof t=="function"?t(j,Ze):j:j+(h?"."+Ze:"["+Ze+"]");M.set(s,C);const Pt=new WeakMap;Pt.set(pn,M),kr(N,Sr(me,Ts,t,n,r,a,i,o,t==="comma"&&w&&ge(_)?null:c,l,u,h,d,g,v,w,y,Pt))}return N}function oi(s=K){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||K.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Pn;if(typeof s.format<"u"){if(!si.call(Rn,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Rn[t];let r=K.filter;(typeof s.filter=="function"||ge(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in xr?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=K.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:K.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:K.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:K.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:K.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?K.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:K.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:K.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:K.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:K.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:K.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:K.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:K.strictNullHandling}}function ci(s,e={}){let t=s;const n=oi(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):ge(n.filter)&&(a=n.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const o=xr[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const l=new WeakMap;for(let d=0;d<r.length;++d){const g=r[d];n.skipNulls&&t[g]===null||kr(i,Sr(t[g],g,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const u=i.join(n.delimiter);let h=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}const ze="4.104.0";let js=!1,ft,Ar,Cr,En,Pr,Rr,Er,Or,$r;function li(s,e={auto:!1}){if(js)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(ft)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${ft}'\``);js=e.auto,ft=s.kind,Ar=s.fetch,Cr=s.FormData,En=s.File,Pr=s.ReadableStream,Rr=s.getMultipartRequestOptions,Er=s.getDefaultAgent,Or=s.fileFromPath,$r=s.isFsReadStream}class ui{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function di({manuallyImported:s}={}){const e=s?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,r,a;try{t=fetch,n=Request,r=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:r,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new ui(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Tr=()=>{ft||li(di(),{auto:!0})};Tr();class A extends Error{}class ee extends A{constructor(e,t,n,r){super(`${ee.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new en({message:n,cause:$n(t)});const a=t==null?void 0:t.error;return e===400?new Ir(e,a,n,r):e===401?new Nr(e,a,n,r):e===403?new jr(e,a,n,r):e===404?new Mr(e,a,n,r):e===409?new Lr(e,a,n,r):e===422?new Fr(e,a,n,r):e===429?new Dr(e,a,n,r):e>=500?new Zr(e,a,n,r):new ee(e,a,n,r)}}class oe extends ee{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class en extends ee{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class qn extends en{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ir extends ee{}class Nr extends ee{}class jr extends ee{}class Mr extends ee{}class Lr extends ee{}class Fr extends ee{}class Dr extends ee{}class Zr extends ee{}class Br extends A{constructor(){super("Could not parse response content as the length limit was reached")}}class Ur extends A{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Rt=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Ne=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},re;class tn{constructor(){re.set(this,void 0),this.buffer=new Uint8Array,Rt(this,re,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let a;for(;(a=hi(this.buffer,Ne(this,re,"f")))!=null;){if(a.carriage&&Ne(this,re,"f")==null){Rt(this,re,a.index,"f");continue}if(Ne(this,re,"f")!=null&&(a.index!==Ne(this,re,"f")+1||a.carriage)){r.push(this.decodeText(this.buffer.slice(0,Ne(this,re,"f")-1))),this.buffer=this.buffer.slice(Ne(this,re,"f")),Rt(this,re,null,"f");continue}const i=Ne(this,re,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));r.push(o),this.buffer=this.buffer.slice(a.index),Rt(this,re,null,"f")}return r}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new A(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new A(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new A("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}re=new WeakMap;tn.NEWLINE_CHARS=new Set([`
`,"\r"]);tn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function hi(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function fi(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}function Vr(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class _e{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of mi(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new ee(void 0,o.error,void 0,Kr(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new ee(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new _e(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const i=new tn,o=Vr(e);for await(const c of o)for(const l of i.decode(c))yield l;for(const c of i.flush())yield c}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of r())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new _e(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new _e(()=>r(e),this.controller),new _e(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Pr({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await t.next();if(i)return r.close();const o=n.encode(JSON.stringify(a)+`
`);r.enqueue(o)}catch(a){r.error(a)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*mi(s,e){if(!s.body)throw e.abort(),new A("Attempted to iterate over a response with no body");const t=new gi,n=new tn,r=Vr(s.body);for await(const a of pi(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*pi(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=fi(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class gi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=yi(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function yi(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}const Wr=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",zr=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&nn(s),nn=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",_i=s=>zr(s)||Wr(s)||$r(s);async function Jr(s,e,t){var r;if(s=await s,zr(s))return s;if(Wr(s)){const a=await s.blob();e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=nn(a)?[await a.arrayBuffer()]:[a];return new En(i,e,t)}const n=await bi(s);if(e||(e=vi(s)??"unknown_file"),!(t!=null&&t.type)){const a=(r=n[0])==null?void 0:r.type;typeof a=="string"&&(t={...t,type:a})}return new En(n,e,t)}async function bi(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(nn(s))e.push(await s.arrayBuffer());else if(xi(s))for await(const n of s)e.push(n);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${wi(s)}`);return e}function wi(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function vi(s){var e;return gn(s.name)||gn(s.filename)||((e=gn(s.path))==null?void 0:e.split(/[\\/]/).pop())}const gn=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},xi=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Ms=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody",Fe=async s=>{const e=await ki(s.body);return Rr(e,s)},ki=async s=>{const e=new Cr;return await Promise.all(Object.entries(s||{}).map(([t,n])=>On(e,t,n))),e},On=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(_i(t)){const n=await Jr(t);s.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>On(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>On(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ke={},Si=function(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t},Ai=function(s,e,t,n){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Et;Tr();async function Hr(s){var i;const{response:e}=s;if(s.options.stream)return Re("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):_e.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return Re("response",e.status,e.url,e.headers,o),qr(o,e)}const a=await e.text();return Re("response",e.status,e.url,e.headers,a),a}function qr(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class sn extends Promise{constructor(e,t=Hr){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new sn(this.responsePromise,async t=>qr(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Ci{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=yn("maxRetries",t),this.timeout=yn("timeout",n),this.httpAgent=r,this.fetch=a??Ar}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...$i(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ji()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async r=>{const a=r&&nn(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:t,...r,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var w;const n={...e},{method:r,path:a,query:i,headers:o={}}=n,c=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Ms(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,l=this.calculateContentLength(c),u=this.buildURL(a,i);"timeout"in n&&yn("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const h=n.httpAgent??this.httpAgent??Er(u),d=n.timeout+1e3;typeof((w=h==null?void 0:h.options)==null?void 0:w.timeout)=="number"&&d>(h.options.timeout??0)&&(h.options.timeout=d),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const g=this.buildHeaders({options:n,headers:o,contentLength:l,retryCount:t});return{req:{method:r,...c&&{body:c},headers:g,...h&&{agent:h},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return Zs(a,i),Zs(a,t),Ms(e.body)&&ft!=="node"&&delete a["content-type"],$t(i,"x-stainless-retry-count")===void 0&&$t(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(r)),$t(i,"x-stainless-timeout")===void 0&&$t(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return ee.generate(e,t,n,r)}request(e,t=null){return new sn(this.makeRequest(e,t))}async makeRequest(e,t){var h,d;const n=await e,r=n.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(a,{url:i,options:n}),Re("request",i,n,a.headers),(h=n.signal)!=null&&h.aborted)throw new oe;const c=new AbortController,l=await this.fetchWithTimeout(i,a,o,c).catch($n);if(l instanceof Error){if((d=n.signal)!=null&&d.aborted)throw new oe;if(t)return this.retryRequest(n,t);throw l.name==="AbortError"?new qn:new en({cause:l})}const u=Kr(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const _=`retrying, ${t} attempts remaining`;return Re(`response (error; ${_})`,l.status,i,u),this.retryRequest(n,t,u)}const g=await l.text().catch(_=>$n(_).message),v=Ti(g),w=v?void 0:g;throw Re(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,u,w),this.makeStatusError(l.status,v,w,u)}return{response:l,options:n,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Pi(this,n,e)}buildURL(e,t){const n=Ni(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Gr(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new A(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n),c={signal:r.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let r;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(r=o)}const i=n==null?void 0:n["retry-after"];if(i&&!r){const o=parseFloat(i);Number.isNaN(o)?r=Date.parse(i)-Date.now():r=o*1e3}if(!(r&&0<=r&&r<60*1e3)){const o=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,o)}return await wt(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ze}`}}class Xr{constructor(e,t,n,r){Et.set(this,void 0),Si(this,Et,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new A("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[r,a]of n)e.url.searchParams.set(r,a);t.query=void 0,t.path=e.url.toString()}return await Ai(this,Et,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Et=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Pi extends sn{constructor(e,t,n){super(t,async r=>new n(e,r.response,await Hr(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Kr=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Ri={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},H=s=>typeof s=="object"&&s!==null&&!Gr(s)&&Object.keys(s).every(e=>Yr(Ri,e)),Ei=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ze,"X-Stainless-OS":Fs(Deno.build.os),"X-Stainless-Arch":Ls(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ze,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ze,"X-Stainless-OS":Fs(process.platform),"X-Stainless-Arch":Ls(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const s=Oi();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ze,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ze,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Oi(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const Ls=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Fs=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Ds;const $i=()=>Ds??(Ds=Ei()),Ti=s=>{try{return JSON.parse(s)}catch{return}},Ii=/^[a-z][a-z0-9+.-]*:/i,Ni=s=>Ii.test(s),wt=s=>new Promise(e=>setTimeout(e,s)),yn=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new A(`${s} must be an integer`);if(e<0)throw new A(`${s} must be a positive integer`);return e},$n=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(s)},Ot=s=>{var e,t,n,r;if(typeof process<"u")return((e=Ke==null?void 0:Ke[s])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(r=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};function Gr(s){if(!s)return!0;for(const e in s)return!1;return!0}function Yr(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Zs(s,e){for(const t in e){if(!Yr(e,t))continue;const n=t.toLowerCase();if(!n)continue;const r=e[t];r===null?delete s[n]:r!==void 0&&(s[n]=r)}}const Bs=new Set(["authorization","api-key"]);function Re(s,...e){if(typeof process<"u"&&(Ke==null?void 0:Ke.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const a={...n,headers:{...n.headers}};for(const i in n.headers)Bs.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let r=null;for(const a in n)Bs.has(a.toLowerCase())&&(r??(r={...n}),r[a]="REDACTED");return r??n});console.log(`OpenAI:DEBUG:${s}`,...t)}}const ji=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),Mi=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Li=s=>typeof(s==null?void 0:s.get)=="function",$t=(s,e)=>{var n;const t=e.toLowerCase();if(Li(s)){const r=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),r]){const i=s.get(a);if(i)return i}}for(const[r,a]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a},Fi=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};function _n(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}class rn extends Xr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class G extends Xr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class P{constructor(e){this._client=e}}let Qr=class extends P{list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Di,{query:t,...n})}},an=class extends P{constructor(){super(...arguments),this.messages=new Qr(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/chat/completions",on,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class on extends G{}class Di extends G{}an.ChatCompletionsPage=on;an.Messages=Qr;let cn=class extends P{constructor(){super(...arguments),this.completions=new an(this._client)}};cn.Completions=an;cn.ChatCompletionsPage=on;class ea extends P{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class ta extends P{create(e,t){return this._client.post("/audio/transcriptions",Fe({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class na extends P{create(e,t){return this._client.post("/audio/translations",Fe({body:e,...t,__metadata:{model:e.model}}))}}class vt extends P{constructor(){super(...arguments),this.transcriptions=new ta(this._client),this.translations=new na(this._client),this.speech=new ea(this._client)}}vt.Transcriptions=ta;vt.Translations=na;vt.Speech=ea;class Xn extends P{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/batches",Kn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Kn extends G{}Xn.BatchesPage=Kn;var de=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},J=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Tn,Ft,Dt,it,ot,Zt,ct,ve,lt,Wt,zt,Je,sa;class Gn{constructor(){Tn.add(this),this.controller=new AbortController,Ft.set(this,void 0),Dt.set(this,()=>{}),it.set(this,()=>{}),ot.set(this,void 0),Zt.set(this,()=>{}),ct.set(this,()=>{}),ve.set(this,{}),lt.set(this,!1),Wt.set(this,!1),zt.set(this,!1),Je.set(this,!1),de(this,Ft,new Promise((e,t)=>{de(this,Dt,e,"f"),de(this,it,t,"f")}),"f"),de(this,ot,new Promise((e,t)=>{de(this,Zt,e,"f"),de(this,ct,t,"f")}),"f"),J(this,Ft,"f").catch(()=>{}),J(this,ot,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},J(this,Tn,"m",sa).bind(this))},0)}_connected(){this.ended||(J(this,Dt,"f").call(this),this._emit("connect"))}get ended(){return J(this,lt,"f")}get errored(){return J(this,Wt,"f")}get aborted(){return J(this,zt,"f")}abort(){this.controller.abort()}on(e,t){return(J(this,ve,"f")[e]||(J(this,ve,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=J(this,ve,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(J(this,ve,"f")[e]||(J(this,ve,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{de(this,Je,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){de(this,Je,!0,"f"),await J(this,ot,"f")}_emit(e,...t){if(J(this,lt,"f"))return;e==="end"&&(de(this,lt,!0,"f"),J(this,Zt,"f").call(this));const n=J(this,ve,"f")[e];if(n&&(J(this,ve,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!J(this,Je,"f")&&!(n!=null&&n.length)&&Promise.reject(r),J(this,it,"f").call(this,r),J(this,ct,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!J(this,Je,"f")&&!(n!=null&&n.length)&&Promise.reject(r),J(this,it,"f").call(this,r),J(this,ct,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Ft=new WeakMap,Dt=new WeakMap,it=new WeakMap,ot=new WeakMap,Zt=new WeakMap,ct=new WeakMap,ve=new WeakMap,lt=new WeakMap,Wt=new WeakMap,zt=new WeakMap,Je=new WeakMap,Tn=new WeakSet,sa=function(e){if(de(this,Wt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new oe),e instanceof oe)return de(this,zt,!0,"f"),this._emit("abort",e);if(e instanceof A)return this._emit("error",e);if(e instanceof Error){const t=new A(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new A(String(e)))};var S=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},se=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Q,In,ye,Bt,he,Le,Xe,Me,Jt,ae,Ut,Vt,mt,ut,dt,Us,Vs,Ws,zs,Js,Hs,qs;class fe extends Gn{constructor(){super(...arguments),Q.add(this),In.set(this,[]),ye.set(this,{}),Bt.set(this,{}),he.set(this,void 0),Le.set(this,void 0),Xe.set(this,void 0),Me.set(this,void 0),Jt.set(this,void 0),ae.set(this,void 0),Ut.set(this,void 0),Vt.set(this,void 0),mt.set(this,void 0)}[(In=new WeakMap,ye=new WeakMap,Bt=new WeakMap,he=new WeakMap,Le=new WeakMap,Xe=new WeakMap,Me=new WeakMap,Jt=new WeakMap,ae=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,mt=new WeakMap,Q=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new fe;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=_e.fromReadableStream(e,this.controller);for await(const i of r)S(this,Q,"m",ut).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new oe;return this._addRun(S(this,Q,"m",dt).call(this))}toReadableStream(){return new _e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,a){const i=new fe;return i._run(()=>i._runToolAssistantStream(e,t,n,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,r,a){var l;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},c=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const u of c)S(this,Q,"m",ut).call(this,u);if((l=c.controller.signal)!=null&&l.aborted)throw new oe;return this._addRun(S(this,Q,"m",dt).call(this))}static createThreadAssistantStream(e,t,n){const r=new fe;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new fe;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return S(this,Ut,"f")}currentRun(){return S(this,Vt,"f")}currentMessageSnapshot(){return S(this,he,"f")}currentRunStepSnapshot(){return S(this,mt,"f")}async finalRunSteps(){return await this.done(),Object.values(S(this,ye,"f"))}async finalMessages(){return await this.done(),Object.values(S(this,Bt,"f"))}async finalRun(){if(await this.done(),!S(this,Le,"f"))throw Error("Final run was not received.");return S(this,Le,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of i)S(this,Q,"m",ut).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new oe;return this._addRun(S(this,Q,"m",dt).call(this))}async _createAssistantStream(e,t,n,r){var c;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)S(this,Q,"m",ut).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new oe;return this._addRun(S(this,Q,"m",dt).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(_n(a)&&_n(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!_n(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,a){return await this._createToolAssistantStream(n,e,t,r,a)}}ut=function(e){if(!this.ended)switch(se(this,Ut,e,"f"),S(this,Q,"m",Ws).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":S(this,Q,"m",qs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":S(this,Q,"m",Vs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":S(this,Q,"m",Us).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},dt=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");if(!S(this,Le,"f"))throw Error("Final run has not been received");return S(this,Le,"f")},Us=function(e){const[t,n]=S(this,Q,"m",Js).call(this,e,S(this,he,"f"));se(this,he,t,"f"),S(this,Bt,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=S(this,Xe,"f")){if(S(this,Me,"f"))switch(S(this,Me,"f").type){case"text":this._emit("textDone",S(this,Me,"f").text,S(this,he,"f"));break;case"image_file":this._emit("imageFileDone",S(this,Me,"f").image_file,S(this,he,"f"));break}se(this,Xe,r.index,"f")}se(this,Me,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(S(this,Xe,"f")!==void 0){const r=e.data.content[S(this,Xe,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,S(this,he,"f"));break;case"text":this._emit("textDone",r.text,S(this,he,"f"));break}}S(this,he,"f")&&this._emit("messageDone",e.data),se(this,he,void 0,"f")}},Vs=function(e){const t=S(this,Q,"m",zs).call(this,e);switch(se(this,mt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==S(this,Jt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(S(this,ae,"f")&&this._emit("toolCallDone",S(this,ae,"f")),se(this,Jt,a.index,"f"),se(this,ae,t.step_details.tool_calls[a.index],"f"),S(this,ae,"f")&&this._emit("toolCallCreated",S(this,ae,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":se(this,mt,void 0,"f"),e.data.step_details.type=="tool_calls"&&S(this,ae,"f")&&(this._emit("toolCallDone",S(this,ae,"f")),se(this,ae,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Ws=function(e){S(this,In,"f").push(e),this._emit("event",e)},zs=function(e){switch(e.event){case"thread.run.step.created":return S(this,ye,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=S(this,ye,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=fe.accumulateDelta(t,n.delta);S(this,ye,"f")[e.data.id]=r}return S(this,ye,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":S(this,ye,"f")[e.data.id]=e.data;break}if(S(this,ye,"f")[e.data.id])return S(this,ye,"f")[e.data.id];throw new Error("No snapshot available")},Js=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=S(this,Q,"m",Hs).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Hs=function(e,t){return fe.accumulateDelta(t,e)},qs=function(e){switch(se(this,Vt,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":se(this,Le,e.data,"f"),S(this,ae,"f")&&(this._emit("toolCallDone",S(this,ae,"f")),se(this,ae,void 0,"f"));break}};class Yn extends P{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/assistants",Qn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Qn extends G{}Yn.AssistantsPage=Qn;function Xs(s){return typeof s.parse=="function"}const Ge=s=>(s==null?void 0:s.role)==="assistant",ra=s=>(s==null?void 0:s.role)==="function",aa=s=>(s==null?void 0:s.role)==="tool";function Zi(s,e){const t={...s};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function es(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function xt(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Bi(s,e){return!e||!ia(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:ts(s,e)}function ts(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new Br;if(n.finish_reason==="content_filter")throw new Ur;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(a=>Vi(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Ui(e,n.message.content):null}}});return{...s,choices:t}}function Ui(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function Vi(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:xt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Wi(s,e){var n;if(!s)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return xt(t)||(t==null?void 0:t.function.strict)||!1}function ia(s){var e;return es(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>xt(t)||t.type==="function"&&t.function.strict===!0))??!1}function zi(s){for(const e of s??[]){if(e.type!=="function")throw new A(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new A(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ne=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},te,Nn,Ht,jn,Mn,Ln,oa,Fn;const Ks=10;class ca extends Gn{constructor(){super(...arguments),te.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(ra(e)||aa(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ge(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ge(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new A("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ne(this,te,"m",Nn).call(this)}async finalMessage(){return await this.done(),ne(this,te,"m",Ht).call(this)}async finalFunctionCall(){return await this.done(),ne(this,te,"m",jn).call(this)}async finalFunctionCallResult(){return await this.done(),ne(this,te,"m",Mn).call(this)}async totalUsage(){return await this.done(),ne(this,te,"m",Ln).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=ne(this,te,"m",Ht).call(this);t&&this._emit("finalMessage",t);const n=ne(this,te,"m",Nn).call(this);n&&this._emit("finalContent",n);const r=ne(this,te,"m",jn).call(this);r&&this._emit("finalFunctionCall",r);const a=ne(this,te,"m",Mn).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",ne(this,te,"m",Ln).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ne(this,te,"m",oa).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ts(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var d;const r="function",{function_call:a="auto",stream:i,...o}=t,c=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:l=Ks}=n||{},u={};for(const g of t.functions)u[g.name||g.function.name]=g;const h=t.functions.map(g=>({name:g.name||g.function.name,parameters:g.parameters,description:g.description}));for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<l;++g){const w=(d=(await this._createChatCompletion(e,{...o,function_call:a,functions:h,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!w)throw new A("missing message in ChatCompletion response");if(!w.function_call)return;const{name:y,arguments:M}=w.function_call,_=u[y];if(_){if(c&&c!==y){const N=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,name:y,content:N});continue}}else{const N=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(I=>JSON.stringify(I.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:y,content:N});continue}let R;try{R=Xs(_)?await _.parse(M):M}catch(N){this._addMessage({role:r,name:y,content:N instanceof Error?N.message:String(N)});continue}const C=await _.function(R,this),z=ne(this,te,"m",Fn).call(this,C);if(this._addMessage({role:r,name:y,content:z}),c)return}}async _runTools(e,t,n){var g,v,w;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&((g=a==null?void 0:a.function)==null?void 0:g.name),{maxChatCompletions:l=Ks}=n||{},u=t.tools.map(y=>{if(xt(y)){if(!y.$callback)throw new A("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of u)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const d="tools"in t?u.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<l;++y){const _=(v=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:d,messages:[...this.messages]},n)).choices[0])==null?void 0:v.message;if(!_)throw new A("missing message in ChatCompletion response");if(!((w=_.tool_calls)!=null&&w.length))return;for(const R of _.tool_calls){if(R.type!=="function")continue;const C=R.id,{name:z,arguments:N}=R.function,I=h[z];if(I){if(c&&c!==z){const Z=`Invalid tool_call: ${JSON.stringify(z)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,tool_call_id:C,content:Z});continue}}else{const Z=`Invalid tool_call: ${JSON.stringify(z)}. Available options are: ${Object.keys(h).map(me=>JSON.stringify(me)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:C,content:Z});continue}let $;try{$=Xs(I)?await I.parse(N):N}catch(Z){const me=Z instanceof Error?Z.message:String(Z);this._addMessage({role:r,tool_call_id:C,content:me});continue}const j=await I.function($,this),W=ne(this,te,"m",Fn).call(this,j);if(this._addMessage({role:r,tool_call_id:C,content:W}),c)return}}}}te=new WeakSet,Nn=function(){return ne(this,te,"m",Ht).call(this).content??null},Ht=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Ge(t)){const{function_call:n,...r}=t,a={...r,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new A("stream ended without producing a ChatCompletionMessage with role=assistant")},jn=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Ge(r)&&(r!=null&&r.function_call))return r.function_call;if(Ge(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Mn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ra(t)&&t.content!=null||aa(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Ln=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},oa=function(e){if(e.n!=null&&e.n>1)throw new A("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Fn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class pt extends ca{static runFunctions(e,t,n){const r=new pt,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new pt,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Ge(e)&&e.content&&this._emit("content",e.content)}}const la=1,ua=2,da=4,ha=8,fa=16,ma=32,pa=64,ga=128,ya=256,_a=ga|ya,ba=fa|ma|_a|pa,wa=la|ua|ba,va=da|ha,Ji=wa|va,Y={STR:la,NUM:ua,ARR:da,OBJ:ha,NULL:fa,BOOL:ma,NAN:pa,INFINITY:ga,MINUS_INFINITY:ya,INF:_a,SPECIAL:ba,ATOM:wa,COLLECTION:va,ALL:Ji};class Hi extends Error{}class qi extends Error{}function Xi(s,e=Y.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ki(s.trim(),e)}const Ki=(s,e)=>{const t=s.length;let n=0;const r=d=>{throw new Hi(`${d} at position ${n}`)},a=d=>{throw new qi(`${d} at position ${n}`)},i=()=>(h(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?c():s[n]==="["?l():s.substring(n,n+4)==="null"||Y.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||Y.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||Y.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||Y.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||Y.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||Y.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):u()),o=()=>{const d=n;let g=!1;for(n++;n<t&&(s[n]!=='"'||g&&s[n-1]==="\\");)g=s[n]==="\\"?!g:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(d,++n-Number(g)))}catch(v){a(String(v))}else if(Y.STR&e)try{return JSON.parse(s.substring(d,n-Number(g))+'"')}catch{return JSON.parse(s.substring(d,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},c=()=>{n++,h();const d={};try{for(;s[n]!=="}";){if(h(),n>=t&&Y.OBJ&e)return d;const g=o();h(),n++;try{const v=i();Object.defineProperty(d,g,{value:v,writable:!0,enumerable:!0,configurable:!0})}catch(v){if(Y.OBJ&e)return d;throw v}h(),s[n]===","&&n++}}catch{if(Y.OBJ&e)return d;r("Expected '}' at end of object")}return n++,d},l=()=>{n++;const d=[];try{for(;s[n]!=="]";)d.push(i()),h(),s[n]===","&&n++}catch{if(Y.ARR&e)return d;r("Expected ']' at end of array")}return n++,d},u=()=>{if(n===0){s==="-"&&Y.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(g){if(Y.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(g))}}const d=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(Y.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(d,n))}catch{s.substring(d,n)==="-"&&Y.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(d,s.lastIndexOf("e")))}catch(v){a(String(v))}}},h=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return i()},Gs=s=>Xi(s,Y.ALL^Y.NUM);var Be=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},U=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},X,we,Ue,ke,bn,Tt,wn,vn,xn,It,kn,Ys;class gt extends ca{constructor(e){super(),X.add(this),we.set(this,void 0),Ue.set(this,void 0),ke.set(this,void 0),Be(this,we,e,"f"),Be(this,Ue,[],"f")}get currentChatCompletionSnapshot(){return U(this,ke,"f")}static fromReadableStream(e){const t=new gt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new gt(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),U(this,X,"m",bn).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)U(this,X,"m",wn).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new oe;return this._addChatCompletion(U(this,X,"m",It).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),U(this,X,"m",bn).call(this),this._connected();const r=_e.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(U(this,X,"m",It).call(this)),U(this,X,"m",wn).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new oe;return this._addChatCompletion(U(this,X,"m",It).call(this))}[(we=new WeakMap,Ue=new WeakMap,ke=new WeakMap,X=new WeakSet,bn=function(){this.ended||Be(this,ke,void 0,"f")},Tt=function(t){let n=U(this,Ue,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},U(this,Ue,"f")[t.index]=n,n)},wn=function(t){var r,a,i,o,c,l,u,h,d,g,v,w,y,M,_;if(this.ended)return;const n=U(this,X,"m",Ys).call(this,t);this._emit("chunk",t,n);for(const R of t.choices){const C=n.choices[R.index];R.delta.content!=null&&((r=C.message)==null?void 0:r.role)==="assistant"&&((a=C.message)!=null&&a.content)&&(this._emit("content",R.delta.content,C.message.content),this._emit("content.delta",{delta:R.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),R.delta.refusal!=null&&((i=C.message)==null?void 0:i.role)==="assistant"&&((o=C.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:R.delta.refusal,snapshot:C.message.refusal}),((c=R.logprobs)==null?void 0:c.content)!=null&&((l=C.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=R.logprobs)==null?void 0:u.content,snapshot:((h=C.logprobs)==null?void 0:h.content)??[]}),((d=R.logprobs)==null?void 0:d.refusal)!=null&&((g=C.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(v=R.logprobs)==null?void 0:v.refusal,snapshot:((w=C.logprobs)==null?void 0:w.refusal)??[]});const z=U(this,X,"m",Tt).call(this,C);C.finish_reason&&(U(this,X,"m",xn).call(this,C),z.current_tool_call_index!=null&&U(this,X,"m",vn).call(this,C,z.current_tool_call_index));for(const N of R.delta.tool_calls??[])z.current_tool_call_index!==N.index&&(U(this,X,"m",xn).call(this,C),z.current_tool_call_index!=null&&U(this,X,"m",vn).call(this,C,z.current_tool_call_index)),z.current_tool_call_index=N.index;for(const N of R.delta.tool_calls??[]){const I=(y=C.message.tool_calls)==null?void 0:y[N.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(M=I.function)==null?void 0:M.name,index:N.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((_=N.function)==null?void 0:_.arguments)??""}):(I==null||I.type,void 0))}}},vn=function(t,n){var i,o,c;if(U(this,X,"m",Tt).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const l=(c=(o=U(this,we,"f"))==null?void 0:o.tools)==null?void 0:c.find(u=>u.type==="function"&&u.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:xt(l)?l.$parseRaw(a.function.arguments):l!=null&&l.function.strict?JSON.parse(a.function.arguments):null})}else a.type},xn=function(t){var r,a;const n=U(this,X,"m",Tt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=U(this,X,"m",kn).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},It=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");const t=U(this,ke,"f");if(!t)throw new A("request ended without sending any chunks");return Be(this,ke,void 0,"f"),Be(this,Ue,[],"f"),Gi(t,U(this,we,"f"))},kn=function(){var n;const t=(n=U(this,we,"f"))==null?void 0:n.response_format;return es(t)?t:null},Ys=function(t){var n,r,a,i;let o=U(this,ke,"f");const{choices:c,...l}=t;o?Object.assign(o,l):o=Be(this,ke,{...l,choices:[]},"f");for(const{delta:u,finish_reason:h,index:d,logprobs:g=null,...v}of t.choices){let w=o.choices[d];if(w||(w=o.choices[d]={finish_reason:h,index:d,message:{},logprobs:g,...v}),g)if(!w.logprobs)w.logprobs=Object.assign({},g);else{const{content:N,refusal:I,...$}=g;Object.assign(w.logprobs,$),N&&((n=w.logprobs).content??(n.content=[]),w.logprobs.content.push(...N)),I&&((r=w.logprobs).refusal??(r.refusal=[]),w.logprobs.refusal.push(...I))}if(h&&(w.finish_reason=h,U(this,we,"f")&&ia(U(this,we,"f")))){if(h==="length")throw new Br;if(h==="content_filter")throw new Ur}if(Object.assign(w,v),!u)continue;const{content:y,refusal:M,function_call:_,role:R,tool_calls:C,...z}=u;if(Object.assign(w.message,z),M&&(w.message.refusal=(w.message.refusal||"")+M),R&&(w.message.role=R),_&&(w.message.function_call?(_.name&&(w.message.function_call.name=_.name),_.arguments&&((a=w.message.function_call).arguments??(a.arguments=""),w.message.function_call.arguments+=_.arguments)):w.message.function_call=_),y&&(w.message.content=(w.message.content||"")+y,!w.message.refusal&&U(this,X,"m",kn).call(this)&&(w.message.parsed=Gs(w.message.content))),C){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:N,id:I,type:$,function:j,...W}of C){const Z=(i=w.message.tool_calls)[N]??(i[N]={});Object.assign(Z,W),I&&(Z.id=I),$&&(Z.type=$),j&&(Z.function??(Z.function={name:j.name??"",arguments:""})),j!=null&&j.name&&(Z.function.name=j.name),j!=null&&j.arguments&&(Z.function.arguments+=j.arguments,Wi(U(this,we,"f"),Z)&&(Z.function.parsed_arguments=Gs(Z.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new _e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Gi(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...o}=s,c={...o,id:t,choices:n.map(({message:l,finish_reason:u,index:h,logprobs:d,...g})=>{if(!u)throw new A(`missing finish_reason for choice ${h}`);const{content:v=null,function_call:w,tool_calls:y,...M}=l,_=l.role;if(!_)throw new A(`missing role for choice ${h}`);if(w){const{arguments:R,name:C}=w;if(R==null)throw new A(`missing function_call.arguments for choice ${h}`);if(!C)throw new A(`missing function_call.name for choice ${h}`);return{...g,message:{content:v,function_call:{arguments:R,name:C},role:_,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:d}}return y?{...g,index:h,finish_reason:u,logprobs:d,message:{...M,role:_,content:v,refusal:l.refusal??null,tool_calls:y.map((R,C)=>{const{function:z,type:N,id:I,...$}=R,{arguments:j,name:W,...Z}=z||{};if(I==null)throw new A(`missing choices[${h}].tool_calls[${C}].id
${Nt(s)}`);if(N==null)throw new A(`missing choices[${h}].tool_calls[${C}].type
${Nt(s)}`);if(W==null)throw new A(`missing choices[${h}].tool_calls[${C}].function.name
${Nt(s)}`);if(j==null)throw new A(`missing choices[${h}].tool_calls[${C}].function.arguments
${Nt(s)}`);return{...$,id:I,type:N,function:{...Z,name:W,arguments:j}}})}}:{...g,message:{...M,content:v,role:_,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:d}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Bi(c,e)}function Nt(s){return JSON.stringify(s)}class Ye extends gt{static fromReadableStream(e){const t=new Ye(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const r=new Ye(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new Ye(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let xa=class extends P{parse(e,t){return zi(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>ts(n,e))}runFunctions(e,t){return e.stream?Ye.runFunctions(this._client,e,t):pt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ye.runTools(this._client,e,t):pt.runTools(this._client,e,t)}stream(e,t){return gt.createChatCompletion(this._client,e,t)}};class Dn extends P{constructor(){super(...arguments),this.completions=new xa(this._client)}}(function(s){s.Completions=xa})(Dn||(Dn={}));class ka extends P{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Sa extends P{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ln extends P{constructor(){super(...arguments),this.sessions=new ka(this._client),this.transcriptionSessions=new Sa(this._client)}}ln.Sessions=ka;ln.TranscriptionSessions=Sa;class ns extends P{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,ss,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class ss extends G{}ns.MessagesPage=ss;class rs extends P{retrieve(e,t,n,r={},a){return H(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},r){return H(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,as,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class as extends G{}rs.RunStepsPage=as;let kt=class extends P{constructor(){super(...arguments),this.steps=new rs(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,is,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return fe.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await wt(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return fe.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const a=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,a.id,r)}submitToolOutputsStream(e,t,n,r){return fe.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}};class is extends G{}kt.RunsPage=is;kt.Steps=rs;kt.RunStepsPage=as;class st extends P{constructor(){super(...arguments),this.runs=new kt(this._client),this.messages=new ns(this._client)}create(e={},t){return H(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return fe.createThreadAssistantStream(e,this._client.beta.threads,t)}}st.Runs=kt;st.RunsPage=is;st.Messages=ns;st.MessagesPage=ss;class rt extends P{constructor(){super(...arguments),this.realtime=new ln(this._client),this.chat=new Dn(this._client),this.assistants=new Yn(this._client),this.threads=new st(this._client)}}rt.Realtime=ln;rt.Assistants=Yn;rt.AssistantsPage=Qn;rt.Threads=st;class Aa extends P{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Ca extends P{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}}let un=class extends P{constructor(){super(...arguments),this.content=new Ca(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,Fe({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,os,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}};class os extends G{}un.FileListResponsesPage=os;un.Content=Ca;class St extends P{constructor(){super(...arguments),this.files=new un(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/containers",cs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class cs extends G{}St.ContainerListResponsesPage=cs;St.Files=un;St.FileListResponsesPage=os;class Pa extends P{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&Re("Request","User defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(Re("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const c=o.embedding;o.embedding=Fi(c)}),i)))}}class ls extends P{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return H(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,us,{query:n,...r})}}class us extends G{}ls.OutputItemListResponsesPage=us;class At extends P{constructor(){super(...arguments),this.outputItems=new ls(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,ds,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class ds extends G{}At.RunListResponsesPage=ds;At.OutputItems=ls;At.OutputItemListResponsesPage=us;class Ct extends P{constructor(){super(...arguments),this.runs=new At(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/evals",hs,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class hs extends G{}Ct.EvalListResponsesPage=hs;Ct.Runs=At;Ct.RunListResponsesPage=ds;let fs=class extends P{create(e,t){return this._client.post("/files",Fe({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/files",ms,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await wt(t),i=await this.retrieve(e),Date.now()-a>n)throw new qn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class ms extends G{}fs.FileObjectsPage=ms;class Ra extends P{}let Ea=class extends P{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class ps extends P{constructor(){super(...arguments),this.graders=new Ea(this._client)}}ps.Graders=Ea;class gs extends P{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,ys,{body:t,method:"post",...n})}retrieve(e,t={},n){return H(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class ys extends rn{}gs.PermissionCreateResponsesPage=ys;let dn=class extends P{constructor(){super(...arguments),this.permissions=new gs(this._client)}};dn.Permissions=gs;dn.PermissionCreateResponsesPage=ys;class _s extends P{list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,bs,{query:t,...n})}}class bs extends G{}_s.FineTuningJobCheckpointsPage=bs;class at extends P{constructor(){super(...arguments),this.checkpoints=new _s(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ws,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return H(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,vs,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class ws extends G{}class vs extends G{}at.FineTuningJobsPage=ws;at.FineTuningJobEventsPage=vs;at.Checkpoints=_s;at.FineTuningJobCheckpointsPage=bs;class Te extends P{constructor(){super(...arguments),this.methods=new Ra(this._client),this.jobs=new at(this._client),this.checkpoints=new dn(this._client),this.alpha=new ps(this._client)}}Te.Methods=Ra;Te.Jobs=at;Te.FineTuningJobsPage=ws;Te.FineTuningJobEventsPage=vs;Te.Checkpoints=dn;Te.Alpha=ps;class Oa extends P{}class xs extends P{constructor(){super(...arguments),this.graderModels=new Oa(this._client)}}xs.GraderModels=Oa;class $a extends P{createVariation(e,t){return this._client.post("/images/variations",Fe({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Fe({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ks extends P{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ss,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Ss extends rn{}ks.ModelsPage=Ss;class Ta extends P{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function Yi(s,e){return!e||!eo(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Ia(s,e)}function Ia(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:so(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:Qi(e,i.text)}:i);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||Na(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function Qi(s,e){var t,n,r,a;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function eo(s){var e;return!!es((e=s.text)==null?void 0:e.format)}function to(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function no(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function so(s,e){const t=no(s.tools??[],e.name);return{...e,...e,parsed_arguments:to(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Na(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}class ja extends P{list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,ao,{query:t,...n})}}var Ve=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Se=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},We,jt,Ae,Mt,Qs,er,tr,nr;class As extends Gn{constructor(e){super(),We.add(this),jt.set(this,void 0),Ae.set(this,void 0),Mt.set(this,void 0),Ve(this,jt,e,"f")}static createResponse(e,t,n){const r=new As(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Se(this,We,"m",Qs).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const c of a)Se(this,We,"m",er).call(this,c,i);if((o=a.controller.signal)!=null&&o.aborted)throw new oe;return Se(this,We,"m",tr).call(this)}[(jt=new WeakMap,Ae=new WeakMap,Mt=new WeakMap,We=new WeakSet,Qs=function(){this.ended||Ve(this,Ae,void 0,"f")},er=function(t,n){if(this.ended)return;const r=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=Se(this,We,"m",nr).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new A(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new A(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new A(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new A(`missing output at index ${t.output_index}`);i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},tr=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");const t=Se(this,Ae,"f");if(!t)throw new A("request ended without sending any events");Ve(this,Ae,void 0,"f");const n=ro(t,Se(this,jt,"f"));return Ve(this,Mt,n,"f"),n},nr=function(t){let n=Se(this,Ae,"f");if(!n){if(t.type!=="response.created")throw new A(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Ve(this,Ae,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new A(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new A(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new A(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new A(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new A(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{Ve(this,Ae,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Se(this,Mt,"f");if(!e)throw new A("stream ended without producing a ChatCompletion");return e}}function ro(s,e){return Yi(s,e)}class Cs extends P{constructor(){super(...arguments),this.inputItems=new ja(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Na(n),n))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Ia(n,e))}stream(e,t){return As.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class ao extends G{}Cs.InputItems=ja;class Ma extends P{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Fe({body:t,...n}))}}class Ps extends P{constructor(){super(...arguments),this.parts=new Ma(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}Ps.Parts=Ma;const io=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class hn extends P{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return H(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,fn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:r}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=a.response.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await wt(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Rs,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class fn extends G{}class Rs extends rn{}hn.VectorStoreFilesPage=fn;hn.FileContentResponsesPage=Rs;class La extends P{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return H(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,fn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await wt(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,c=t.values(),l=[...n];async function u(d){for(let g of d){const v=await o.files.create({file:g,purpose:"assistants"},r);l.push(v.id)}}const h=Array(i).fill(c).map(u);return await io(h),await this.createAndPoll(e,{file_ids:l})}}class Ie extends P{constructor(){super(...arguments),this.files=new hn(this._client),this.fileBatches=new La(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/vector_stores",Es,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Os,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Es extends G{}class Os extends rn{}Ie.VectorStoresPage=Es;Ie.VectorStoreSearchResponsesPage=Os;Ie.Files=hn;Ie.VectorStoreFilesPage=fn;Ie.FileContentResponsesPage=Rs;Ie.FileBatches=La;var Fa;class E extends Ci{constructor({baseURL:e=Ot("OPENAI_BASE_URL"),apiKey:t=Ot("OPENAI_API_KEY"),organization:n=Ot("OPENAI_ORG_ID")??null,project:r=Ot("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new A("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Mi())throw new A(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Aa(this),this.chat=new cn(this),this.embeddings=new Pa(this),this.files=new fs(this),this.images=new $a(this),this.audio=new vt(this),this.moderations=new Ta(this),this.models=new ks(this),this.fineTuning=new Te(this),this.graders=new xs(this),this.vectorStores=new Ie(this),this.beta=new rt(this),this.batches=new Xn(this),this.uploads=new Ps(this),this.responses=new Cs(this),this.evals=new Ct(this),this.containers=new St(this),this._options=i,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return ci(e,{arrayFormat:"brackets"})}}Fa=E;E.OpenAI=Fa;E.DEFAULT_TIMEOUT=6e5;E.OpenAIError=A;E.APIError=ee;E.APIConnectionError=en;E.APIConnectionTimeoutError=qn;E.APIUserAbortError=oe;E.NotFoundError=Mr;E.ConflictError=Lr;E.RateLimitError=Dr;E.BadRequestError=Ir;E.AuthenticationError=Nr;E.InternalServerError=Zr;E.PermissionDeniedError=jr;E.UnprocessableEntityError=Fr;E.toFile=Jr;E.fileFromPath=Or;E.Completions=Aa;E.Chat=cn;E.ChatCompletionsPage=on;E.Embeddings=Pa;E.Files=fs;E.FileObjectsPage=ms;E.Images=$a;E.Audio=vt;E.Moderations=Ta;E.Models=ks;E.ModelsPage=Ss;E.FineTuning=Te;E.Graders=xs;E.VectorStores=Ie;E.VectorStoresPage=Es;E.VectorStoreSearchResponsesPage=Os;E.Beta=rt;E.Batches=Xn;E.BatchesPage=Kn;E.Uploads=Ps;E.Responses=Cs;E.Evals=Ct;E.EvalListResponsesPage=hs;E.Containers=St;E.ContainerListResponsesPage=cs;/*! js-cookie v3.0.5 | MIT */function Lt(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)s[n]=t[n]}return s}var oo={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Zn(s,e){function t(r,a,i){if(!(typeof document>"u")){i=Lt({},e,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var c in i)i[c]&&(o+="; "+c,i[c]!==!0&&(o+="="+i[c].split(";")[0]));return document.cookie=r+"="+s.write(a,r)+o}}function n(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var a=document.cookie?document.cookie.split("; "):[],i={},o=0;o<a.length;o++){var c=a[o].split("="),l=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(i[u]=s.read(l,u),r===u)break}catch{}}return r?i[r]:i}}return Object.create({set:t,get:n,remove:function(r,a){t(r,"",Lt({},a,{expires:-1}))},withAttributes:function(r){return Zn(this.converter,Lt({},this.attributes,r))},withConverter:function(r){return Zn(Lt({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(s)}})}var He=Zn(oo,{path:"/"});function co(){const[s,e]=V.useState(""),[t,n]=V.useState(!1),[r,a]=V.useState(null),[i,o]=V.useState(!1),[c,l]=V.useState(!1);V.useEffect(()=>{const d=He.get("openai_api_key");d&&(e(d),n(!0))},[]);const u=async()=>{o(!0),a(null),l(!1);try{const g=await new E({apiKey:s,dangerouslyAllowBrowser:!0}).responses.create({model:"gpt-4.1-nano",input:"Say hello"});g&&g.output_text?(a({message:"API key is valid.",status:"success"}),He.set("openai_api_key",s,{expires:30,secure:!0,sameSite:"strict"}),n(!0)):(a({message:"API key is invalid or request failed.",status:"error"}),He.remove("openai_api_key"),n(!1)),setTimeout(()=>{l(!0)},2500),setTimeout(()=>{a(null),l(!1)},3e3)}catch(d){a({message:`API key is invalid or request failed: ${d.message}`,status:"error"}),He.remove("openai_api_key"),n(!1),setTimeout(()=>{l(!0)},2500),setTimeout(()=>{a(null),l(!1)},3e3)}finally{o(!1)}},h=()=>{He.remove("openai_api_key"),e(""),a({message:"API key deleted.",status:"success"}),n(!1),l(!1),setTimeout(()=>{l(!0)},2500),setTimeout(()=>{a(null),l(!1)},3e3)};return p.jsxs("main",{className:"max-w-3xl mx-auto p-8 bg-white rounded-lg shadow-lg mt-10 font-secondary",children:[p.jsx("h2",{className:"text-3xl font-extrabold mb-6 text-gray-900 font-primary",children:"Set up your OpenAI API key"}),p.jsx("label",{htmlFor:"api-key-input",className:"block mb-2 text-gray-700 font-medium",children:"OpenAI API key"}),p.jsx("input",{id:"api-key-input",type:"text",placeholder:"Enter your OpenAI API key",value:s,onChange:d=>e(d.target.value),className:"w-full p-3 border border-gray-300 rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition"}),p.jsx("button",{onClick:u,disabled:i||!s,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 text-white font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center",children:i?p.jsxs(p.Fragment,{children:[p.jsx(Hn,{}),"Checking..."]}):"Check and save API Key"}),s&&t&&p.jsxs("div",{className:"mt-6 flex justify-between items-center bg-green-100 border border-green-400 text-green-900 p-4 rounded-lg",children:[p.jsx("p",{className:"text-lg font-medium",children:"API key is loaded from cookie."}),p.jsx("button",{onClick:h,className:"ml-4 py-2 px-4 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition",children:"Delete Key"})]}),r&&p.jsxs("p",{className:`mt-6 p-4 rounded-lg flex items-center text-lg font-medium transition-opacity duration-500 ${c?"opacity-0":"opacity-100"} ${r.status==="success"?"bg-green-100 text-green-900 border border-green-400":"bg-red-100 text-red-900 border border-red-400"}`,role:"alert",children:[r.status==="success"?p.jsx("svg",{className:"w-6 h-6 mr-3 text-green-600",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:p.jsx("path",{d:"M7.629 13.314l-3.292-3.292-1.414 1.414 4.706 4.706 9-9-1.414-1.414z"})}):p.jsx("svg",{className:"w-6 h-6 mr-3 text-red-600",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:p.jsx("path",{d:"M10 8.586l4.95-4.95 1.414 1.414L11.414 10l4.95 4.95-1.414 1.414L10 11.414l-4.95 4.95-1.414-1.414L8.586 10 3.636 5.05l1.414-1.414L10 8.586z"})}),r.message]})]})}const lo=Symbol("Let zodToJsonSchema decide on which parser to use"),sr={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},uo=s=>typeof s=="string"?{...sr,basePath:["#"],definitions:{},name:s}:{...sr,basePath:["#"],definitions:{},...s},Bn=s=>"_def"in s?s._def:s;function ho(s){if(!s)return!0;for(const e in s)return!1;return!0}const fo=s=>{const e=uo(s),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,r])=>[Bn(r),{def:Bn(r),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Da(s,e,t,n){n!=null&&n.errorMessages&&t&&(s.errorMessage={...s.errorMessage,[e]:t})}function B(s,e,t,n,r){s[e]=t,Da(s,e,n,r)}var F;(function(s){s.assertEqual=r=>{};function e(r){}s.assertIs=e;function t(r){throw new Error}s.assertNever=t,s.arrayToEnum=r=>{const a={};for(const i of r)a[i]=i;return a},s.getValidEnumValues=r=>{const a=s.objectKeys(r).filter(o=>typeof r[r[o]]!="number"),i={};for(const o of a)i[o]=r[o];return s.objectValues(i)},s.objectValues=r=>s.objectKeys(r).map(function(a){return r[a]}),s.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.push(i);return a},s.find=(r,a)=>{for(const i of r)if(a(i))return i},s.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function n(r,a=" | "){return r.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}s.joinValues=n,s.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(F||(F={}));var rr;(function(s){s.mergeShapes=(e,t)=>({...e,...t})})(rr||(rr={}));const x=F.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ce=s=>{switch(typeof s){case"undefined":return x.undefined;case"string":return x.string;case"number":return Number.isNaN(s)?x.nan:x.number;case"boolean":return x.boolean;case"function":return x.function;case"bigint":return x.bigint;case"symbol":return x.symbol;case"object":return Array.isArray(s)?x.array:s===null?x.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?x.promise:typeof Map<"u"&&s instanceof Map?x.map:typeof Set<"u"&&s instanceof Set?x.set:typeof Date<"u"&&s instanceof Date?x.date:x.object;default:return x.unknown}},f=F.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class xe extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},r=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(r);else if(i.code==="invalid_return_type")r(i.returnTypeError);else if(i.code==="invalid_arguments")r(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,c=0;for(;c<i.path.length;){const l=i.path[c];c===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return r(this),n}static assert(e){if(!(e instanceof xe))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,F.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}xe.create=s=>new xe(s);const Un=(s,e)=>{let t;switch(s.code){case f.invalid_type:s.received===x.undefined?t="Required":t=`Expected ${s.expected}, received ${s.received}`;break;case f.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(s.expected,F.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:t=`Unrecognized key(s) in object: ${F.joinValues(s.keys,", ")}`;break;case f.invalid_union:t="Invalid input";break;case f.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${F.joinValues(s.options)}`;break;case f.invalid_enum_value:t=`Invalid enum value. Expected ${F.joinValues(s.options)}, received '${s.received}'`;break;case f.invalid_arguments:t="Invalid function arguments";break;case f.invalid_return_type:t="Invalid function return type";break;case f.invalid_date:t="Invalid date";break;case f.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(t=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?t=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?t=`Invalid input: must end with "${s.validation.endsWith}"`:F.assertNever(s.validation):s.validation!=="regex"?t=`Invalid ${s.validation}`:t="Invalid";break;case f.too_small:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:t="Invalid input";break;case f.too_big:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?t=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:t="Invalid input";break;case f.custom:t="Invalid input";break;case f.invalid_intersection_types:t="Intersection results could not be merged";break;case f.not_multiple_of:t=`Number must be a multiple of ${s.multipleOf}`;break;case f.not_finite:t="Number must be finite";break;default:t=e.defaultError,F.assertNever(s)}return{message:t}};let mo=Un;function po(){return mo}const go=s=>{const{data:e,path:t,errorMaps:n,issueData:r}=s,a=[...t,...r.path||[]],i={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let o="";const c=n.filter(l=>!!l).slice().reverse();for(const l of c)o=l(i,{data:e,defaultError:o}).message;return{...r,path:a,message:o}};function b(s,e){const t=po(),n=go({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,t,t===Un?void 0:Un].filter(r=>!!r)});s.common.issues.push(n)}class ie{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if(r.status==="aborted")return O;r.status==="dirty"&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const r of t){const a=await r.key,i=await r.value;n.push({key:a,value:i})}return ie.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:a,value:i}=r;if(a.status==="aborted"||i.status==="aborted")return O;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||r.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const O=Object.freeze({status:"aborted"}),ht=s=>({status:"dirty",value:s}),ce=s=>({status:"valid",value:s}),ar=s=>s.status==="aborted",ir=s=>s.status==="dirty",Qe=s=>s.status==="valid",qt=s=>typeof Promise<"u"&&s instanceof Promise;var k;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(k||(k={}));class Oe{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const or=(s,e)=>{if(Qe(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new xe(s.common.issues);return this._error=t,this._error}}};function T(s){if(!s)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:r}=s;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(i,o)=>{const{message:c}=s;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??t??o.defaultError}},description:r}}class L{get description(){return this._def.description}_getType(e){return Ce(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ce(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ie,ctx:{common:e.parent.common,data:e.data,parsedType:Ce(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(qt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ce(e)},r=this._parseSync({data:e,path:n.path,parent:n});return or(n,r)}"~validate"(e){var n,r;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ce(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:t});return Qe(a)?{value:a.value}:{issues:t.common.issues}}catch(a){(r=(n=a==null?void 0:a.message)==null?void 0:n.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(a=>Qe(a)?{value:a.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ce(e)},r=this._parse({data:e,path:n.path,parent:n}),a=await(qt(r)?r:Promise.resolve(r));return or(n,a)}refine(e,t){const n=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,a)=>{const i=e(r),o=()=>a.addIssue({code:f.custom,...n(r)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t=="function"?t(n,r):t),!1))}_refinement(e){return new tt({schema:this,typeName:m.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ee.create(this,this._def)}nullable(){return nt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return be.create(this)}promise(){return Yt.create(this,this._def)}or(e){return Kt.create([this,e],this._def)}and(e){return Gt.create(this,e,this._def)}transform(e){return new tt({...T(this._def),schema:this,typeName:m.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Wn({...T(this._def),innerType:this,defaultValue:t,typeName:m.ZodDefault})}brand(){return new Do({typeName:m.ZodBranded,type:this,...T(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new zn({...T(this._def),innerType:this,catchValue:t,typeName:m.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return $s.create(this,e)}readonly(){return Jn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const yo=/^c[^\s-]{8,}$/i,_o=/^[0-9a-z]+$/,bo=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vo=/^[a-z0-9_-]{21}$/i,xo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ko=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,So=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ao="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Sn;const Co=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Po=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ro=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Eo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Oo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$o=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Za="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",To=new RegExp(`^${Za}$`);function Ba(s){let e="[0-5]\\d";s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`);const t=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Io(s){return new RegExp(`^${Ba(s)}$`)}function No(s){let e=`${Za}T${Ba(s)}`;const t=[];return t.push(s.local?"Z?":"Z"),s.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function jo(s,e){return!!((e==="v4"||!e)&&Co.test(s)||(e==="v6"||!e)&&Ro.test(s))}function Mo(s,e){if(!xo.test(s))return!1;try{const[t]=s.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(n));return!(typeof r!="object"||r===null||"typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function Lo(s,e){return!!((e==="v4"||!e)&&Po.test(s)||(e==="v6"||!e)&&Eo.test(s))}class Pe extends L{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==x.string){const a=this._getOrReturnCtx(e);return b(a,{code:f.invalid_type,expected:x.string,received:a.parsedType}),O}const n=new ie;let r;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(r=this._getOrReturnCtx(e,r),i?b(r,{code:f.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&b(r,{code:f.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")So.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"email",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")Sn||(Sn=new RegExp(Ao,"u")),Sn.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"emoji",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")wo.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"uuid",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")vo.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"nanoid",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")yo.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"cuid",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")_o.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"cuid2",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")bo.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"ulid",code:f.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),b(r,{validation:"url",code:f.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"regex",code:f.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?No(a).test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?To.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?Io(a).test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?ko.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"duration",code:f.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?jo(e.data,a.version)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"ip",code:f.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?Mo(e.data,a.alg)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"jwt",code:f.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Lo(e.data,a.version)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"cidr",code:f.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?Oo.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"base64",code:f.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?$o.test(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{validation:"base64url",code:f.invalid_string,message:a.message}),n.dirty()):F.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(r=>e.test(r),{validation:t,code:f.invalid_string,...k.errToObj(n)})}_addCheck(e){return new Pe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...k.errToObj(e)})}url(e){return this._addCheck({kind:"url",...k.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...k.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...k.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...k.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...k.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...k.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...k.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...k.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...k.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...k.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...k.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...k.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...k.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...k.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...k.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...k.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...k.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...k.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...k.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...k.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...k.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...k.errToObj(t)})}nonempty(e){return this.min(1,k.errToObj(e))}trim(){return new Pe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Pe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Pe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Pe.create=s=>new Pe({checks:[],typeName:m.ZodString,coerce:(s==null?void 0:s.coerce)??!1,...T(s)});function Fo(s,e){const t=(s.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,r=t>n?t:n,a=Number.parseInt(s.toFixed(r).replace(".","")),i=Number.parseInt(e.toFixed(r).replace(".",""));return a%i/10**r}class yt extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==x.number){const a=this._getOrReturnCtx(e);return b(a,{code:f.invalid_type,expected:x.number,received:a.parsedType}),O}let n;const r=new ie;for(const a of this._def.checks)a.kind==="int"?F.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),b(n,{code:f.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?Fo(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),b(n,{code:f.not_finite,message:a.message}),r.dirty()):F.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(e,t,n,r){return new yt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:k.toString(r)}]})}_addCheck(e){return new yt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:k.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:k.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:k.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:k.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&F.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}yt.create=s=>new yt({checks:[],typeName:m.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...T(s)});class _t extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==x.bigint)return this._getInvalidInput(e);let n;const r=new ie;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),b(n,{code:f.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):F.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:x.bigint,received:t.parsedType}),O}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(e,t,n,r){return new _t({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:k.toString(r)}]})}_addCheck(e){return new _t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}_t.create=s=>new _t({checks:[],typeName:m.ZodBigInt,coerce:(s==null?void 0:s.coerce)??!1,...T(s)});class cr extends L{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==x.boolean){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.boolean,received:n.parsedType}),O}return ce(e.data)}}cr.create=s=>new cr({typeName:m.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...T(s)});class Xt extends L{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==x.date){const a=this._getOrReturnCtx(e);return b(a,{code:f.invalid_type,expected:x.date,received:a.parsedType}),O}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return b(a,{code:f.invalid_date}),O}const n=new ie;let r;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):F.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Xt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:k.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:k.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Xt.create=s=>new Xt({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:m.ZodDate,...T(s)});class lr extends L{_parse(e){if(this._getType(e)!==x.symbol){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.symbol,received:n.parsedType}),O}return ce(e.data)}}lr.create=s=>new lr({typeName:m.ZodSymbol,...T(s)});class ur extends L{_parse(e){if(this._getType(e)!==x.undefined){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.undefined,received:n.parsedType}),O}return ce(e.data)}}ur.create=s=>new ur({typeName:m.ZodUndefined,...T(s)});class dr extends L{_parse(e){if(this._getType(e)!==x.null){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.null,received:n.parsedType}),O}return ce(e.data)}}dr.create=s=>new dr({typeName:m.ZodNull,...T(s)});class hr extends L{constructor(){super(...arguments),this._any=!0}_parse(e){return ce(e.data)}}hr.create=s=>new hr({typeName:m.ZodAny,...T(s)});class fr extends L{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ce(e.data)}}fr.create=s=>new fr({typeName:m.ZodUnknown,...T(s)});class $e extends L{_parse(e){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:x.never,received:t.parsedType}),O}}$e.create=s=>new $e({typeName:m.ZodNever,...T(s)});class mr extends L{_parse(e){if(this._getType(e)!==x.undefined){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.void,received:n.parsedType}),O}return ce(e.data)}}mr.create=s=>new mr({typeName:m.ZodVoid,...T(s)});class be extends L{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==x.array)return b(t,{code:f.invalid_type,expected:x.array,received:t.parsedType}),O;if(r.exactLength!==null){const i=t.data.length>r.exactLength.value,o=t.data.length<r.exactLength.value;(i||o)&&(b(t,{code:i?f.too_big:f.too_small,minimum:o?r.exactLength.value:void 0,maximum:i?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(b(t,{code:f.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(b(t,{code:f.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>r.type._parseAsync(new Oe(t,i,t.path,o)))).then(i=>ie.mergeArray(n,i));const a=[...t.data].map((i,o)=>r.type._parseSync(new Oe(t,i,t.path,o)));return ie.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new be({...this._def,minLength:{value:e,message:k.toString(t)}})}max(e,t){return new be({...this._def,maxLength:{value:e,message:k.toString(t)}})}length(e,t){return new be({...this._def,exactLength:{value:e,message:k.toString(t)}})}nonempty(e){return this.min(1,e)}}be.create=(s,e)=>new be({type:s,minLength:null,maxLength:null,exactLength:null,typeName:m.ZodArray,...T(e)});function qe(s){if(s instanceof q){const e={};for(const t in s.shape){const n=s.shape[t];e[t]=Ee.create(qe(n))}return new q({...s._def,shape:()=>e})}else return s instanceof be?new be({...s._def,type:qe(s.element)}):s instanceof Ee?Ee.create(qe(s.unwrap())):s instanceof nt?nt.create(qe(s.unwrap())):s instanceof De?De.create(s.items.map(e=>qe(e))):s}class q extends L{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=F.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==x.object){const l=this._getOrReturnCtx(e);return b(l,{code:f.invalid_type,expected:x.object,received:l.parsedType}),O}const{status:n,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof $e&&this._def.unknownKeys==="strip"))for(const l in r.data)i.includes(l)||o.push(l);const c=[];for(const l of i){const u=a[l],h=r.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Oe(r,h,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof $e){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:r.data[u]}});else if(l==="strict")o.length>0&&(b(r,{code:f.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const h=r.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Oe(r,h,r.path,u)),alwaysSet:u in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const h=await u.key,d=await u.value;l.push({key:h,value:d,alwaysSet:u.alwaysSet})}return l}).then(l=>ie.mergeObjectSync(n,l)):ie.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return k.errToObj,new q({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var a,i;const r=((i=(a=this._def).errorMap)==null?void 0:i.call(a,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:k.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new q({...this._def,unknownKeys:"strip"})}passthrough(){return new q({...this._def,unknownKeys:"passthrough"})}extend(e){return new q({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new q({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:m.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new q({...this._def,catchall:e})}pick(e){const t={};for(const n of F.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new q({...this._def,shape:()=>t})}omit(e){const t={};for(const n of F.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new q({...this._def,shape:()=>t})}deepPartial(){return qe(this)}partial(e){const t={};for(const n of F.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new q({...this._def,shape:()=>t})}required(e){const t={};for(const n of F.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Ee;)a=a._def.innerType;t[n]=a}return new q({...this._def,shape:()=>t})}keyof(){return Ua(F.objectKeys(this.shape))}}q.create=(s,e)=>new q({shape:()=>s,unknownKeys:"strip",catchall:$e.create(),typeName:m.ZodObject,...T(e)});q.strictCreate=(s,e)=>new q({shape:()=>s,unknownKeys:"strict",catchall:$e.create(),typeName:m.ZodObject,...T(e)});q.lazycreate=(s,e)=>new q({shape:s,unknownKeys:"strip",catchall:$e.create(),typeName:m.ZodObject,...T(e)});class Kt extends L{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function r(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new xe(o.ctx.common.issues));return b(t,{code:f.invalid_union,unionErrors:i}),O}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(r);{let a;const i=[];for(const c of n){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new xe(c));return b(t,{code:f.invalid_union,unionErrors:o}),O}}get options(){return this._def.options}}Kt.create=(s,e)=>new Kt({options:s,typeName:m.ZodUnion,...T(e)});function Vn(s,e){const t=Ce(s),n=Ce(e);if(s===e)return{valid:!0,data:s};if(t===x.object&&n===x.object){const r=F.objectKeys(e),a=F.objectKeys(s).filter(o=>r.indexOf(o)!==-1),i={...s,...e};for(const o of a){const c=Vn(s[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===x.array&&n===x.array){if(s.length!==e.length)return{valid:!1};const r=[];for(let a=0;a<s.length;a++){const i=s[a],o=e[a],c=Vn(i,o);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===x.date&&n===x.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class Gt extends L{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(a,i)=>{if(ar(a)||ar(i))return O;const o=Vn(a.value,i.value);return o.valid?((ir(a)||ir(i))&&t.dirty(),{status:t.value,value:o.data}):(b(n,{code:f.invalid_intersection_types}),O)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>r(a,i)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Gt.create=(s,e,t)=>new Gt({left:s,right:e,typeName:m.ZodIntersection,...T(t)});class De extends L{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==x.array)return b(n,{code:f.invalid_type,expected:x.array,received:n.parsedType}),O;if(n.data.length<this._def.items.length)return b(n,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&n.data.length>this._def.items.length&&(b(n,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new Oe(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>ie.mergeArray(t,i)):ie.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new De({...this._def,rest:e})}}De.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new De({items:s,typeName:m.ZodTuple,rest:null,...T(e)})};class pr extends L{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==x.map)return b(n,{code:f.invalid_type,expected:x.map,received:n.parsedType}),O;const r=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,c],l)=>({key:r._parse(new Oe(n,o,n.path,[l,"key"])),value:a._parse(new Oe(n,c,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return O;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return O;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}pr.create=(s,e,t)=>new pr({valueType:e,keyType:s,typeName:m.ZodMap,...T(t)});class bt extends L{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==x.set)return b(n,{code:f.invalid_type,expected:x.set,received:n.parsedType}),O;const r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(b(n,{code:f.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(b(n,{code:f.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const l=new Set;for(const u of c){if(u.status==="aborted")return O;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((c,l)=>a._parse(new Oe(n,c,n.path,l)));return n.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new bt({...this._def,minSize:{value:e,message:k.toString(t)}})}max(e,t){return new bt({...this._def,maxSize:{value:e,message:k.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}bt.create=(s,e)=>new bt({valueType:s,minSize:null,maxSize:null,typeName:m.ZodSet,...T(e)});class gr extends L{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}gr.create=(s,e)=>new gr({getter:s,typeName:m.ZodLazy,...T(e)});class yr extends L{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return b(t,{received:t.data,code:f.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:e.data}}get value(){return this._def.value}}yr.create=(s,e)=>new yr({value:s,typeName:m.ZodLiteral,...T(e)});function Ua(s,e){return new et({values:s,typeName:m.ZodEnum,...T(e)})}class et extends L{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return b(t,{expected:F.joinValues(n),received:t.parsedType,code:f.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return b(t,{received:t.data,code:f.invalid_enum_value,options:n}),O}return ce(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return et.create(e,{...this._def,...t})}exclude(e,t=this._def){return et.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}et.create=Ua;class _r extends L{_parse(e){const t=F.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==x.string&&n.parsedType!==x.number){const r=F.objectValues(t);return b(n,{expected:F.joinValues(r),received:n.parsedType,code:f.invalid_type}),O}if(this._cache||(this._cache=new Set(F.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=F.objectValues(t);return b(n,{received:n.data,code:f.invalid_enum_value,options:r}),O}return ce(e.data)}get enum(){return this._def.values}}_r.create=(s,e)=>new _r({values:s,typeName:m.ZodNativeEnum,...T(e)});class Yt extends L{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==x.promise&&t.common.async===!1)return b(t,{code:f.invalid_type,expected:x.promise,received:t.parsedType}),O;const n=t.parsedType===x.promise?t.data:Promise.resolve(t.data);return ce(n.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Yt.create=(s,e)=>new Yt({type:s,typeName:m.ZodPromise,...T(e)});class tt extends L{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===m.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:i=>{b(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),r.type==="preprocess"){const i=r.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return O;const c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?O:c.status==="dirty"||t.value==="dirty"?ht(c.value):c});{if(t.value==="aborted")return O;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?O:o.status==="dirty"||t.value==="dirty"?ht(o.value):o}}if(r.type==="refinement"){const i=o=>{const c=r.refinement(o,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?O:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?O:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(r.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Qe(i))return O;const o=r.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Qe(i)?Promise.resolve(r.transform(i.value,a)).then(o=>({status:t.value,value:o})):O);F.assertNever(r)}}tt.create=(s,e,t)=>new tt({schema:s,typeName:m.ZodEffects,effect:e,...T(t)});tt.createWithPreprocess=(s,e,t)=>new tt({schema:e,effect:{type:"preprocess",transform:s},typeName:m.ZodEffects,...T(t)});class Ee extends L{_parse(e){return this._getType(e)===x.undefined?ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ee.create=(s,e)=>new Ee({innerType:s,typeName:m.ZodOptional,...T(e)});class nt extends L{_parse(e){return this._getType(e)===x.null?ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}nt.create=(s,e)=>new nt({innerType:s,typeName:m.ZodNullable,...T(e)});class Wn extends L{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===x.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Wn.create=(s,e)=>new Wn({innerType:s,typeName:m.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...T(e)});class zn extends L{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return qt(r)?r.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new xe(n.common.issues)},input:n.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new xe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}zn.create=(s,e)=>new zn({innerType:s,typeName:m.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...T(e)});class br extends L{_parse(e){if(this._getType(e)!==x.nan){const n=this._getOrReturnCtx(e);return b(n,{code:f.invalid_type,expected:x.nan,received:n.parsedType}),O}return{status:"valid",value:e.data}}}br.create=s=>new br({typeName:m.ZodNaN,...T(s)});class Do extends L{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class $s extends L{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?O:a.status==="dirty"?(t.dirty(),ht(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const r=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?O:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:n.path,parent:n})}}static create(e,t){return new $s({in:e,out:t,typeName:m.ZodPipeline})}}class Jn extends L{_parse(e){const t=this._def.innerType._parse(e),n=r=>(Qe(r)&&(r.value=Object.freeze(r.value)),r);return qt(t)?t.then(r=>n(r)):n(t)}unwrap(){return this._def.innerType}}Jn.create=(s,e)=>new Jn({innerType:s,typeName:m.ZodReadonly,...T(e)});var m;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(m||(m={}));const An=Pe.create;$e.create;const Zo=be.create,Va=q.create;Kt.create;Gt.create;De.create;et.create;Yt.create;Ee.create;nt.create;function Bo(){return{}}function Uo(s,e){var n,r;const t={type:"array"};return((r=(n=s.type)==null?void 0:n._def)==null?void 0:r.typeName)!==m.ZodAny&&(t.items=D(s.type._def,{...e,currentPath:[...e.currentPath,"items"]})),s.minLength&&B(t,"minItems",s.minLength.value,s.minLength.message,e),s.maxLength&&B(t,"maxItems",s.maxLength.value,s.maxLength.message,e),s.exactLength&&(B(t,"minItems",s.exactLength.value,s.exactLength.message,e),B(t,"maxItems",s.exactLength.value,s.exactLength.message,e)),t}function Vo(s,e){const t={type:"integer",format:"int64"};if(!s.checks)return t;for(const n of s.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?B(t,"minimum",n.value,n.message,e):B(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),B(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?B(t,"maximum",n.value,n.message,e):B(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),B(t,"maximum",n.value,n.message,e));break;case"multipleOf":B(t,"multipleOf",n.value,n.message,e);break}return t}function Wo(){return{type:"boolean"}}function zo(s,e){return D(s.type._def,e)}const Jo=(s,e)=>D(s.innerType._def,e);function Wa(s,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((r,a)=>Wa(s,e,r))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ho(s,e)}}const Ho=(s,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of s.checks)switch(n.kind){case"min":B(t,"minimum",n.value,n.message,e);break;case"max":B(t,"maximum",n.value,n.message,e);break}return t};function qo(s,e){return{...D(s.innerType._def,e),default:s.defaultValue()}}function Xo(s,e,t){return e.effectStrategy==="input"?D(s.schema._def,e,t):{}}function Ko(s){return{type:"string",enum:[...s.values]}}const Go=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function Yo(s,e){const t=[D(s.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(s.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const r=[];return t.forEach(a=>{if(Go(a))r.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else n=void 0;r.push(i)}}),r.length?{allOf:r,...n}:void 0}function Qo(s,e){const t=typeof s.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(s.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[s.value]}:{type:t==="bigint"?"integer":t,const:s.value}}let Cn;const je={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Cn===void 0&&(Cn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Cn),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function za(s,e){const t={type:"string"};function n(r){return e.patternStrategy==="escape"?ec(r):r}if(s.checks)for(const r of s.checks)switch(r.kind){case"min":B(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":B(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":le(t,"email",r.message,e);break;case"format:idn-email":le(t,"idn-email",r.message,e);break;case"pattern:zod":ue(t,je.email,r.message,e);break}break;case"url":le(t,"uri",r.message,e);break;case"uuid":le(t,"uuid",r.message,e);break;case"regex":ue(t,r.regex,r.message,e);break;case"cuid":ue(t,je.cuid,r.message,e);break;case"cuid2":ue(t,je.cuid2,r.message,e);break;case"startsWith":ue(t,RegExp(`^${n(r.value)}`),r.message,e);break;case"endsWith":ue(t,RegExp(`${n(r.value)}$`),r.message,e);break;case"datetime":le(t,"date-time",r.message,e);break;case"date":le(t,"date",r.message,e);break;case"time":le(t,"time",r.message,e);break;case"duration":le(t,"duration",r.message,e);break;case"length":B(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),B(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{ue(t,RegExp(n(r.value)),r.message,e);break}case"ip":{r.version!=="v6"&&le(t,"ipv4",r.message,e),r.version!=="v4"&&le(t,"ipv6",r.message,e);break}case"emoji":ue(t,je.emoji,r.message,e);break;case"ulid":{ue(t,je.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{le(t,"binary",r.message,e);break}case"contentEncoding:base64":{B(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{ue(t,je.base64,r.message,e);break}}break}case"nanoid":ue(t,je.nanoid,r.message,e)}return t}const ec=s=>Array.from(s).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),le=(s,e,t,n)=>{var r;s.format||(r=s.anyOf)!=null&&r.some(a=>a.format)?(s.anyOf||(s.anyOf=[]),s.format&&(s.anyOf.push({format:s.format,...s.errorMessage&&n.errorMessages&&{errorMessage:{format:s.errorMessage.format}}}),delete s.format,s.errorMessage&&(delete s.errorMessage.format,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):B(s,"format",e,t,n)},ue=(s,e,t,n)=>{var r;s.pattern||(r=s.allOf)!=null&&r.some(a=>a.pattern)?(s.allOf||(s.allOf=[]),s.pattern&&(s.allOf.push({pattern:s.pattern,...s.errorMessage&&n.errorMessages&&{errorMessage:{pattern:s.errorMessage.pattern}}}),delete s.pattern,s.errorMessage&&(delete s.errorMessage.pattern,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.allOf.push({pattern:wr(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):B(s,"pattern",wr(e,n),t,n)},wr=(s,e)=>{var l;const t=typeof s=="function"?s():s;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let a="",i=!1,o=!1,c=!1;for(let u=0;u<r.length;u++){if(i){a+=r[u],i=!1;continue}if(n.i){if(o){if(r[u].match(/[a-z]/)){c?(a+=r[u],a+=`${r[u-2]}-${r[u]}`.toUpperCase(),c=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(a+=r[u],c=!0):a+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){a+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(n.m){if(r[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[u]==="."){a+=o?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}a+=r[u],r[u]==="\\"?i=!0:o&&r[u]==="]"?o=!1:!o&&r[u]==="["&&(o=!0)}try{const u=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function Ja(s,e){var n,r,a,i;if(e.target==="openApi3"&&((n=s.keyType)==null?void 0:n._def.typeName)===m.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((o,c)=>({...o,[c]:D(s.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:D(s.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((r=s.keyType)==null?void 0:r._def.typeName)===m.ZodString&&((a=s.keyType._def.checks)!=null&&a.length)){const o=Object.entries(za(s.keyType._def,e)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...t,propertyNames:o}}else if(((i=s.keyType)==null?void 0:i._def.typeName)===m.ZodEnum)return{...t,propertyNames:{enum:s.keyType._def.values}};return t}function tc(s,e){if(e.mapStrategy==="record")return Ja(s,e);const t=D(s.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=D(s.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function nc(s){const e=s.values,n=Object.keys(s.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),r=Array.from(new Set(n.map(a=>typeof a)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:n}}function sc(){return{not:{}}}function rc(s){return s.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Qt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ac(s,e){if(e.target==="openApi3")return vr(s,e);const t=s.options instanceof Map?Array.from(s.options.values()):s.options;if(t.every(n=>n._def.typeName in Qt&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((r,a)=>{const i=Qt[a._def.typeName];return i&&!r.includes(i)?[...r,i]:r},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((r,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...r,i];case"bigint":return[...r,"integer"];case"object":if(a._def.value===null)return[...r,"null"];case"symbol":case"undefined":case"function":default:return r}},[]);if(n.length===t.length){const r=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:r.length>1?r:r[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,r)=>[...n,...r._def.values.filter(a=>!n.includes(a))],[])};return vr(s,e)}const vr=(s,e)=>{const t=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((n,r)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${r}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function ic(s,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(s.innerType._def.typeName)&&(!s.innerType._def.checks||!s.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Qt[s.innerType._def.typeName],nullable:!0}:{type:[Qt[s.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=D(s.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=D(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function oc(s,e){const t={type:"number"};if(!s.checks)return t;for(const n of s.checks)switch(n.kind){case"int":t.type="integer",Da(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?B(t,"minimum",n.value,n.message,e):B(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),B(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?B(t,"maximum",n.value,n.message,e):B(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),B(t,"maximum",n.value,n.message,e));break;case"multipleOf":B(t,"multipleOf",n.value,n.message,e);break}return t}function cc(s,e){return e.removeAdditionalStrategy==="strict"?s.catchall._def.typeName==="ZodNever"?s.unknownKeys!=="strict":D(s.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:s.catchall._def.typeName==="ZodNever"?s.unknownKeys==="passthrough":D(s.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function lc(s,e){const t={type:"object",...Object.entries(s.shape()).reduce((n,[r,a])=>{if(a===void 0||a._def===void 0)return n;const i=[...e.currentPath,"properties",r],o=D(a._def,{...e,currentPath:i,propertyPath:i});return o===void 0?n:(e.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...n.properties,[r]:o},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,r]})},{properties:{},required:[]}),additionalProperties:cc(s,e)};return t.required.length||delete t.required,t}const uc=(s,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return D(s.innerType._def,e);const t=D(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},dc=(s,e)=>{if(e.pipeStrategy==="input")return D(s.in._def,e);if(e.pipeStrategy==="output")return D(s.out._def,e);const t=D(s.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(s.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(r=>r!==void 0)}};function hc(s,e){return D(s.type._def,e)}function fc(s,e){const n={type:"array",uniqueItems:!0,items:D(s.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return s.minSize&&B(n,"minItems",s.minSize.value,s.minSize.message,e),s.maxSize&&B(n,"maxItems",s.maxSize.value,s.maxSize.message,e),n}function mc(s,e){return s.rest?{type:"array",minItems:s.items.length,items:s.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:D(s.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:s.items.length,maxItems:s.items.length,items:s.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function pc(){return{not:{}}}function gc(){return{}}const yc=(s,e)=>D(s.innerType._def,e);function D(s,e,t=!1){var i;const n=e.seen.get(s);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,s,e,n,t);if(o!==lo)return o}if(n&&!t){const o=_c(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const r={def:s,path:e.currentPath,jsonSchema:void 0};e.seen.set(s,r);const a=wc(s,s.typeName,e,t);return a&&vc(s,e,a),r.jsonSchema=a,a}const _c=(s,e)=>{switch(e.$refStrategy){case"root":return{$ref:s.path.join("/")};case"extract-to-root":const t=s.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=s.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:bc(e.currentPath,s.path)};case"none":case"seen":return s.path.length<e.currentPath.length&&s.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},bc=(s,e)=>{let t=0;for(;t<s.length&&t<e.length&&s[t]===e[t];t++);return[(s.length-t).toString(),...e.slice(t)].join("/")},wc=(s,e,t,n)=>{switch(e){case m.ZodString:return za(s,t);case m.ZodNumber:return oc(s,t);case m.ZodObject:return lc(s,t);case m.ZodBigInt:return Vo(s,t);case m.ZodBoolean:return Wo();case m.ZodDate:return Wa(s,t);case m.ZodUndefined:return pc();case m.ZodNull:return rc(t);case m.ZodArray:return Uo(s,t);case m.ZodUnion:case m.ZodDiscriminatedUnion:return ac(s,t);case m.ZodIntersection:return Yo(s,t);case m.ZodTuple:return mc(s,t);case m.ZodRecord:return Ja(s,t);case m.ZodLiteral:return Qo(s,t);case m.ZodEnum:return Ko(s);case m.ZodNativeEnum:return nc(s);case m.ZodNullable:return ic(s,t);case m.ZodOptional:return uc(s,t);case m.ZodMap:return tc(s,t);case m.ZodSet:return fc(s,t);case m.ZodLazy:return D(s.getter()._def,t);case m.ZodPromise:return hc(s,t);case m.ZodNaN:case m.ZodNever:return sc();case m.ZodEffects:return Xo(s,t,n);case m.ZodAny:return Bo();case m.ZodUnknown:return gc();case m.ZodDefault:return qo(s,t);case m.ZodBranded:return zo(s,t);case m.ZodReadonly:return yc(s,t);case m.ZodCatch:return Jo(s,t);case m.ZodPipeline:return dc(s,t);case m.ZodFunction:case m.ZodVoid:case m.ZodSymbol:return;default:return(r=>{})()}},vc=(s,e,t)=>(s.description&&(t.description=s.description,e.markdownDescription&&(t.markdownDescription=s.description)),t),xc=(s,e)=>{const t=fo(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,r=D(s._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(r.title=a);const i=(()=>{if(ho(t.definitions))return;const c={},l=new Set;for(let u=0;u<500;u++){const h=Object.entries(t.definitions).filter(([d])=>!l.has(d));if(h.length===0)break;for(const[d,g]of h)c[d]=D(Bn(g),{...t,currentPath:[...t.basePath,t.definitionPath,d]},!0)??{},l.add(d)}return c})(),o=n===void 0?i?{...r,[t.definitionPath]:i}:r:t.nameStrategy==="duplicate-ref"?{...r,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:r}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:r}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function kc(s,e){return xc(s,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Ha(s,e,t){return Zi({type:"json_schema",...t,name:e,strict:!0,schema:kc(s,{name:e})},n=>s.parse(JSON.parse(n)))}const Sc="https://head-checker.louispaulet13.workers.dev/?url=";function qa({recommendations:s,prompt:e}){const t=V.useMemo(()=>{const d=[],g=new Set;for(const v of s)g.has(v.channel_url)||(d.push(v),g.add(v.channel_url));return d},[s]),[n,r]=V.useState({}),[a,i]=V.useState(!1);V.useEffect(()=>{async function d(v){const w=Sc+v;try{return(await(await fetch(w,{method:"GET"})).json()).status}catch(y){return console.error("Error fetching URL status:",y),null}}async function g(){const v=t.map(async y=>{try{const M=await d(y.channel_url);return{url:y.channel_url,status:M}}catch(M){return console.error("Error checking status for",y.channel_url,M),{url:y.channel_url,status:null}}}),w=await Promise.all(v);r(y=>{const M={...y};return w.forEach(({url:_,status:R})=>{M[_]=R}),M})}g()},[t]);function o(d){return d===200?{liClass:"p-3 border border-green-600 rounded bg-green-100 text-green-800 flex items-center justify-between",icon:p.jsxs("div",{className:"tooltip","data-tooltip":"Verified Link (HTTP 200)",children:[p.jsx("svg",{className:"w-5 h-5 text-green-700",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24","aria-hidden":"true",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),p.jsx("span",{className:"sr-only",children:"Verified Link (HTTP 200)"})]})}:d===404?{liClass:"p-3 border border-gray-500 rounded bg-gray-200 text-gray-800 flex items-center justify-between",icon:p.jsxs("div",{className:"tooltip","data-tooltip":"Incorrect Link (HTTP 404)",children:[p.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24","aria-hidden":"true",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),p.jsx("span",{className:"sr-only",children:"Incorrect Link (HTTP 404)"})]})}:d?{liClass:"p-3 border border-yellow-400 rounded bg-yellow-50 text-yellow-800 flex items-center justify-between",icon:p.jsxs("div",{className:"tooltip","data-tooltip":`Link Status: HTTP ${d}`,children:[p.jsx("svg",{className:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24","aria-hidden":"true",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsx("span",{className:"sr-only",children:`Link Status: HTTP ${d}`})]})}:{liClass:"p-3 border border-gray-300 rounded bg-gray-50 flex items-center justify-between",icon:null}}function c(d){if(!e)return!1;const g=y=>y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),v=new RegExp(`\\b${g(d.channel_name)}\\b`,"i"),w=new RegExp(g(d.channel_url),"i");return v.test(e)||w.test(e)}function l(){return p.jsx("span",{className:"text-green-700 ml-2",title:"Duplicate","aria-hidden":"true",children:"â™»"})}const u=[...t].sort((d,g)=>{const v=n[d.channel_url],w=n[g.channel_url],y=c(d),M=c(g);function _(z,N){return z===200?1:z===404?2:N?3:4}const R=_(v,y),C=_(w,M);return R!==C?R-C:0}),h=a?u:u.filter(d=>!c(d));return p.jsxs("div",{className:"bg-white font-secondary",children:[p.jsxs("label",{className:"my-4 flex items-center cursor-pointer select-none",children:[p.jsx("span",{className:"mr-3 text-gray-800 font-semibold font-secondary",children:"Show Duplicates"}),p.jsx("input",{type:"checkbox",checked:a,onChange:()=>i(!a),className:"sr-only","aria-label":"Toggle display of duplicate recommendations"}),p.jsx("div",{className:`w-12 h-6 rounded-full transition-colors duration-300 ease-in-out ${a?"bg-primary-600":"bg-gray-300"}`,children:p.jsx("div",{className:`bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 ease-in-out ${a?"translate-x-6":"translate-x-0"}`})})]}),p.jsx("ul",{className:"mt-6 space-y-3 relative",children:h.map((d,g)=>{const v=n[d.channel_url],{liClass:w,icon:y}=o(v),M=c(d);let _="";return v===200?_="Verified Link (HTTP 200)":v===404?_="Incorrect Link (HTTP 404)":v&&(_=`Link Status: HTTP ${v}`),p.jsxs("li",{className:`${w} rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3 cursor-pointer flex flex-col md:flex-row md:items-center md:justify-between`,role:"link",tabIndex:0,onClick:()=>window.open(d.channel_url,"_blank","noopener,noreferrer"),onKeyDown:R=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),window.open(d.channel_url,"_blank","noopener,noreferrer"))},children:[p.jsx("span",{className:"text-primary-700 font-semibold mb-2 md:mb-0",style:{minWidth:"10rem"},children:d.channel_name}),p.jsx("p",{className:"text-gray-700 text-sm italic mb-2 md:mb-0 md:flex-grow md:text-center",children:d.recommendation_reason}),p.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[y&&p.jsxs("div",{className:"group relative cursor-pointer focus:outline-none",tabIndex:0,"aria-label":_,children:[y,p.jsxs("div",{className:"absolute z-10 invisible opacity-0 group-hover:visible group-hover:opacity-100 group-focus-visible:visible group-focus-visible:opacity-100 inline-block px-4 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs tooltip dark:bg-gray-700 whitespace-nowrap max-w-[20rem] overflow-hidden text-ellipsis",style:{bottom:"125%",left:"50%",transform:"translateX(-50%)"},children:[_,p.jsx("div",{className:"tooltip-arrow","data-popper-arrow":!0})]})]}),M&&p.jsxs("div",{className:"group relative cursor-pointer focus:outline-none",tabIndex:0,"aria-label":"Duplicate",children:[l(),p.jsxs("div",{className:"absolute z-10 invisible opacity-0 group-hover:visible group-hover:opacity-100 group-focus-visible:visible group-focus-visible:opacity-100 inline-block px-4 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs tooltip dark:bg-gray-700 whitespace-nowrap max-w-[20rem] overflow-hidden text-ellipsis",style:{bottom:"125%",left:"50%",transform:"translateX(-50%)"},children:["Duplicate",p.jsx("div",{className:"tooltip-arrow","data-popper-arrow":!0})]})]})]})]},g)})})]})}const Ac=Va({channel_name:An(),channel_url:An(),recommendation_reason:An()}),Xa=Va({recommendations:Zo(Ac)});function Ka(){return He.get("openai_api_key")}const Cc=["Summoning AI","Feeding hamsters","Consulting oracles","Tickling electrons","Shaking dice","Polishing pixels","Untangling wires","Charging creativity crystals","Calibrating sarcasm detector","Counting penguins","Rebooting flux capacitor","Tuning algorithms","Petting server hamsters","Firing up puns","Rearranging playlists","Herding rubber ducks","Recycling jokes"];function Pc(s){for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}function Ga(s,e,t=Cc,n=2e3){const[r,a]=V.useState(e),i=V.useRef(0),o=V.useRef(t);return V.useEffect(()=>{if(s){o.current=Pc([...t]),i.current=0,a(o.current[i.current]);const c=setInterval(()=>{i.current=(i.current+1)%o.current.length,a(o.current[i.current])},n);return()=>clearInterval(c)}i.current=0,a(e)},[s,e,t,n]),r}function Rc({subscriptions:s,recommendations:e}){const[t,n]=V.useState([]),[r,a]=V.useState(!1),[i,o]=V.useState(null),c=Ga(r,"Get Improved Recommendations"),[l,u]=Is.useState("");Is.useEffect(()=>{const d=Ka();d&&u(d)},[]);const h=async()=>{a(!0),o(null);try{const d=new E({apiKey:l,dangerouslyAllowBrowser:!0}),g=`You are a YouTube channel recommender assistant. Given the user's current subscriptions:
${s.join(", ")}

And the previous recommendations:
${e.map(y=>y.channel_name).join(", ")}

Please provide a new list of ${e.length} YouTube channel recommendations that are better than the previous list. Each recommendation should include the channel_name, channel_url, and a brief recommendation_reason. Respond ONLY in JSON format as an array of objects.`,w=(await d.responses.parse({model:"gpt-4.1-nano",input:[{role:"system",content:"You are a helpful assistant that recommends YouTube channels."},{role:"user",content:g}],text:{format:Ha(Xa,"recommendations")}})).output_parsed.recommendations||[];n(w)}catch(d){o("Error fetching improved recommendations: "+d.message)}finally{a(!1)}};return p.jsxs("div",{className:"mt-8 p-6 bg-gray-50 rounded-lg shadow-md font-secondary",children:[p.jsx("h2",{className:"text-2xl font-semibold mb-4 font-primary",children:"Criticizer: GetÂ Better Recommendations"}),p.jsx("button",{onClick:h,disabled:r,className:"mb-4 w-full py-3 bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 text-white font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center",children:r?p.jsxs(p.Fragment,{children:[p.jsx(Hn,{}),c]}):c}),i&&p.jsx("p",{className:"text-red-600 mb-4",children:i}),t.length>0&&p.jsx(qa,{recommendations:t,prompt:`User subscriptions: ${s.join(", ")}. Previous recommendations: ${e.map(d=>d.channel_name).join(", ")}`})]})}function Ec(s){return s.split(/[\n,;]+/).map(e=>e.trim()).filter(e=>e.length>0)}function Oc(s){const t=new DOMParser().parseFromString(s,"text/html");return Array.from(t.querySelectorAll("ytd-channel-renderer")).map(r=>{const a=r.querySelector('a.channel-link[href*="/@"]');if(a){const i=a.getAttribute("href").trim();return i.startsWith("http")?i:`https://www.youtube.com${i}`}return null}).filter(Boolean)}function $c(){const[s,e]=V.useState(""),[t,n]=V.useState(null),[r,a]=V.useState(!1),[i,o]=V.useState(10),[c,l]=V.useState(""),[u,h]=V.useState(""),[d,g]=V.useState(!1),[v,w]=V.useState(!1),[y,M]=V.useState(!1),[_,R]=V.useState(""),C=Ga(r,"Get Recommendations"),z=$=>{g($),$||(e(""),w(!1),R(""))},N=$=>{if(!$.type.includes("html")){R("Please upload a valid HTML file.");return}R("");const j=new FileReader;j.onload=W=>{const Z=W.target.result,me=Oc(Z);me.length===0&&R("No channels found. Did you save the correct page?"),e(me.join(`
`))},j.onerror=()=>R("Failed to read file."),j.readAsText($)},I=async()=>{const $=Ka();if(!$){n("API key not found. Please set your OpenAI API key in the homepage.");return}a(!0),n(null);try{const j=new E({apiKey:$,dangerouslyAllowBrowser:!0}),W=u.trim()?`Consider these preferred topics or keywords when making recommendations: ${u}.`:"",Z=d&&s.trim()?`The input list of subscribed channels:

${s}

Do NOT recommend a channel that is already present in the input list.`:"",Ze=[`Please suggest ${i} new YouTube channels to watch.`,W,Z].filter(Ya=>Ya).join(`
`);l(Ze);const Pt=(await j.responses.parse({model:"gpt-4.1-nano",input:[{role:"system",content:"You are a helpful assistant that recommends YouTube channels."},{role:"user",content:Ze}],text:{format:Ha(Xa,"recommendations")}})).output_parsed.recommendations;n(Pt)}catch(j){console.error("Error fetching recommendations:",j),n("Failed to get recommendations. Please check your API key and try again.")}finally{a(!1)}};return p.jsxs("section",{className:"max-w-3xl mx-auto p-8 mt-10 bg-white rounded-lg shadow-lg font-secondary",children:[p.jsx("h2",{className:"text-3xl font-extrabold mb-6 text-gray-900 font-primary",children:"YouTube Channel Recommender"}),p.jsxs("label",{className:"block mb-4 text-gray-700 font-medium",children:[p.jsx("input",{type:"checkbox",checked:d,onChange:$=>z($.target.checked),className:"mr-2"}),"Use my subscription list"]}),d&&p.jsxs("div",{className:"mb-6 space-y-4",children:[p.jsx("button",{type:"button",onClick:()=>w($=>!$),className:"text-primary-700 underline",children:v?"Hide subscription importer":"Upload subscriptions HTML file"}),v&&p.jsx("div",{onDragOver:$=>{$.preventDefault(),M(!0)},onDragLeave:$=>{$.preventDefault(),M(!1)},onDrop:$=>{$.preventDefault(),M(!1);const j=$.dataTransfer.files&&$.dataTransfer.files[0];j&&N(j)},className:`p-4 border-2 border-dashed rounded-lg ${y?"bg-primary-50 border-primary-600":"border-gray-300"}`,children:p.jsx("input",{type:"file",accept:"text/html",onChange:$=>{const j=$.target.files&&$.target.files[0];j&&N(j)},className:"w-full"})}),_&&p.jsx("p",{className:"text-sm text-red-600",children:_}),p.jsx("textarea",{rows:5,placeholder:"Your subscriptions will appear here",value:s,onChange:$=>e($.target.value),className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition"})]}),p.jsxs("label",{className:"block mb-4 text-gray-700 font-medium",children:["Number of recommendations to make:",p.jsx("input",{type:"number",min:"1",value:i,onChange:$=>o(Number($.target.value)),className:"ml-3 p-2 border border-gray-300 rounded w-20 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition"})]}),p.jsxs("label",{className:"block mb-4 text-gray-700 font-medium",children:["Preferred topics or keywords:",p.jsx("input",{type:"text",placeholder:"e.g. technology, cooking",value:u,onChange:$=>h($.target.value),className:"mt-1 p-2 border border-gray-300 rounded w-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition"})]}),p.jsx("button",{onClick:I,disabled:r,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 text-white font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center",children:r?p.jsxs(p.Fragment,{children:[p.jsx(Hn,{}),C]}):C}),t&&(Array.isArray(t)?p.jsxs(p.Fragment,{children:[p.jsx(qa,{recommendations:t,prompt:c}),p.jsx(Rc,{subscriptions:Ec(s),recommendations:t})]}):p.jsx("pre",{className:"mt-6 p-4 bg-gray-100 border border-gray-300 rounded-lg whitespace-pre-wrap",children:t}))]})}function Jc(){return p.jsxs("div",{className:"py-12 px-4 sm:px-6 lg:px-8 max-w-5xl mx-auto font-secondary",children:[p.jsx("h1",{className:"text-3xl sm:text-6xl font-extrabold font-primary text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 drop-shadow-lg mb-12 text-center",children:"GPT YouTube Channel Recommender"}),p.jsx("section",{className:"mb-10 p-6 bg-primary-100 rounded-lg shadow-md text-primary-900 font-medium text-center text-lg font-accent",children:"Input your current YouTube subscriptions, and get a curated recommendation list!"}),p.jsx(co,{}),p.jsx("div",{className:"mt-12",children:p.jsx($c,{})})]})}export{Jc as default};
